<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>View shared assets</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:20px;max-width:960px}
    img{max-width:100%;height:auto;margin:8px 0}
    .item{margin-bottom:12px}
    .meta{font-size:0.9rem;color:#555}
  </style>
</head>
<body>
  <h1>Shared assets</h1>
  <div id="content">Loadingâ€¦</div>

  <script>
    function qsParam(name){
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }

    (async function(){
      const content = document.getElementById('content');
      const id = qsParam('share');
      if (!id) { content.innerHTML = '<p>No share id.</p>'; return; }

      // Fetch the share JSON from GitHub Pages static content
      // shares/{id}.json is committed to the repo by the server and served via GitHub Pages
      const shareUrl = new URL(`./shares/${id}.json`, location.origin + location.pathname.replace(/\/[^\/]*$/,'/')).href;
      try {
        const resp = await fetch(shareUrl);
        if (!resp.ok) throw new Error('Share not found (HTTP ' + resp.status + ')');
        const share = await resp.json();
        content.innerHTML = '';

        if (share.files && share.files.length) {
          for (const f of share.files) {
            const wrap = document.createElement('div'); wrap.className = 'item';
            if (f.name && /\.(jpe?g|png|gif|webp|svg|bmp)$/i.test(f.name)) {
              const img = document.createElement('img'); img.src = f.url; wrap.appendChild(img);
            } else if (f.name && /\.(mp3|wav|ogg|m4a)$/i.test(f.name)) {
              const a = document.createElement('audio'); a.controls = true; a.src = f.url; wrap.appendChild(a);
            } else {
              // generic link
              const a = document.createElement('a'); a.href = f.url; a.textContent = f.name || f.url; a.target = '_blank'; wrap.appendChild(a);
            }

            const meta = document.createElement('div'); meta.className = 'meta';
            const dl = document.createElement('a'); dl.href = f.url; dl.download = f.name || '';
            dl.textContent = 'Download';
            meta.appendChild(document.createTextNode((f.name ? f.name + ' ' : '') + '(' + (f.url || '') + ') '));
            meta.appendChild(dl);
            wrap.appendChild(meta);
            content.appendChild(wrap);
          }
        } else {
          content.innerHTML = '<p>No files in share.</p>';
        }
      } catch (err) {
        console.error(err);
        content.innerHTML = '<p>Error loading share: ' + err.message + '</p>';
      }
    })();
  </script>
</body>
</html>
