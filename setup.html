<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upload & create share (upload to GitHub repo)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:20px;max-width:900px}
    textarea{width:100%;height:120px}
  </style>
</head>
<body>
  <h1>Upload files — produce share link</h1>
  <p>Select images and/or audio and click Upload. Files will be saved into your GitHub repo under uploads/ and a share link will be generated.</p>

  <label>Files (multiple):
    <input id="files" type="file" multiple>
  </label>
  <p>
    Server URL: <input id="server" placeholder="https://your-server.example" style="width:60%">
    <small>Set to the domain where the Node uploader is deployed (e.g., https://uploader.example.com).</small>
  </p>
  <p><button id="upload">Upload & create share</button></p>

  <h3>Result</h3>
  <div id="result">No upload yet</div>

  <script>
    document.getElementById('upload').addEventListener('click', async () => {
      const files = document.getElementById('files').files;
      const server = document.getElementById('server').value.trim();
      if (!server) return alert('Enter server URL where uploader is deployed.');
      if (!files.length) return alert('Choose one or more files.');

      const fd = new FormData();
      for (const f of files) fd.append('files', f, f.name);

      const resDiv = document.getElementById('result');
      resDiv.textContent = 'Uploading…';

      try {
        const resp = await fetch(server.replace(/\/$/, '') + '/upload', { method: 'POST', body: fd });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || JSON.stringify(data));
        resDiv.innerHTML = '<p>Share URL (copy and give to recipients):</p>' +
          `<p><a href="${data.pagesURL}" target="_blank">${data.pagesURL}</a></p>` +
          `<pre>${JSON.stringify(data.share, null, 2)}</pre>`;
      } catch (err) {
        console.error(err);
        resDiv.textContent = 'Upload failed: ' + err.message;
      }
    });
  </script>
</body>
</html>
