<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create your Valentine ‚Äì Upload</title>
  <meta name="description" content="Create a personalized Valentine with images and music.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Crimson+Text:wght@400;600&family=Sacramento&display=swap" rel="stylesheet">
  <style>
    :root{
      --rose:#d4567f;
      --deep-rose:#a13d5f;
      --blush:#ffeef4;
      --cream:#fff9fc;
      --gold:#d4a574;
      --shadow:rgba(212,86,127,0.15);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    html,body{
      height:100%;
      font-family:'Crimson Text',Georgia,serif;
      background:radial-gradient(ellipse at top, var(--blush), var(--cream));
      color:#2d1a24;
    }
    
    body{
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:40px 20px;
      position:relative;
      overflow-x:hidden;
    }
    
    /* Floating hearts background */
    .hearts-bg {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }
    
    .heart-float {
      position:absolute;
      font-size:20px;
      opacity:0.08;
      animation:floatUp 15s infinite ease-in;
    }
    
    @keyframes floatUp {
      0% { transform:translateY(100vh) rotate(0deg); opacity:0; }
      10% { opacity:0.1; }
      90% { opacity:0.05; }
      100% { transform:translateY(-100vh) rotate(360deg); opacity:0; }
    }
    
    .sheet{
      width:100%;
      max-width:720px;
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(20px);
      border-radius:30px;
      padding:40px;
      box-shadow:0 20px 60px var(--shadow), inset 0 1px 0 rgba(255,255,255,0.8);
      border:1px solid rgba(255,255,255,0.5);
      position:relative;
      z-index:1;
      opacity:0;
      animation:sheetAppear 1s forwards 0.3s;
    }
    
    @keyframes sheetAppear {
      to { opacity:1; transform:translateY(0); }
      from { transform:translateY(20px); }
    }
    
    .sheet::before {
      content:'';
      position:absolute;
      top:20px;
      left:20px;
      width:80px;
      height:80px;
      border-top:2px solid var(--rose);
      border-left:2px solid var(--rose);
      border-radius:15px 0 0 0;
      opacity:0.2;
    }
    
    .sheet::after {
      content:'';
      position:absolute;
      bottom:20px;
      right:20px;
      width:80px;
      height:80px;
      border-bottom:2px solid var(--rose);
      border-right:2px solid var(--rose);
      border-radius:0 0 15px 0;
      opacity:0.2;
    }
    
    h1{
      margin:0 0 10px;
      font-family:'Sacramento',cursive;
      font-size:3rem;
      color:var(--rose);
      text-align:center;
      text-shadow:2px 2px 4px rgba(212,86,127,0.1);
    }
    
    .intro{
      text-align:center;
      font-size:1.1rem;
      color:#5a3a4d;
      margin-bottom:30px;
      line-height:1.6;
      font-style:italic;
    }
    
    label{
      display:block;
      margin-top:24px;
      font-size:1.1rem;
      color:var(--deep-rose);
      font-weight:600;
      font-family:'Cormorant Garamond',serif;
    }
    
    input[type="text"], 
    textarea, 
    select{
      width:100%;
      padding:14px 18px;
      border-radius:15px;
      border:2px solid rgba(212,86,127,0.2);
      margin-top:10px;
      box-sizing:border-box;
      font-family:'Crimson Text',serif;
      font-size:1rem;
      background:rgba(255,255,255,0.8);
      transition:all 0.3s;
    }
    
    input[type="text"]:focus, 
    textarea:focus, 
    select:focus{
      outline:none;
      border-color:var(--rose);
      box-shadow:0 0 0 3px rgba(212,86,127,0.1);
      background:#fff;
    }
    
    textarea{
      min-height:100px;
      resize:vertical;
    }
    
    input[type="file"]{
      width:100%;
      padding:14px;
      border-radius:15px;
      border:2px dashed rgba(212,86,127,0.3);
      margin-top:10px;
      box-sizing:border-box;
      font-family:'Crimson Text',serif;
      cursor:pointer;
      background:rgba(255,249,252,0.5);
      transition:all 0.3s;
    }
    
    input[type="file"]:hover{
      border-color:var(--rose);
      background:rgba(255,249,252,0.8);
    }
    
    .hint{
      font-size:0.95rem;
      color:#999;
      margin-top:8px;
      font-style:italic;
    }
    
    .actions{
      display:flex;
      gap:15px;
      align-items:center;
      margin-top:30px;
    }
    
    button.primary{
      background:linear-gradient(135deg, var(--rose) 0%, var(--deep-rose) 100%);
      color:#fff;
      padding:16px 32px;
      border:none;
      border-radius:50px;
      font-weight:600;
      font-size:1.1rem;
      font-family:'Crimson Text',serif;
      flex:1;
      cursor:pointer;
      transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow:0 10px 30px rgba(212,86,127,0.3);
      position:relative;
      overflow:hidden;
    }
    
    button.primary::before {
      content:'';
      position:absolute;
      top:50%;
      left:50%;
      width:0;
      height:0;
      border-radius:50%;
      background:rgba(255,255,255,0.2);
      transform:translate(-50%, -50%);
      transition:width 0.6s, height 0.6s;
    }
    
    button.primary:hover::before {
      width:400px;
      height:400px;
    }
    
    button.primary:hover{
      transform:translateY(-2px);
      box-shadow:0 15px 40px rgba(212,86,127,0.4);
    }
    
    button.primary:disabled{
      opacity:0.5;
      cursor:not-allowed;
      transform:none;
      background:linear-gradient(135deg, #ccc 0%, #999 100%);
    }
    
    button.primary:disabled:hover{
      transform:none;
      box-shadow:0 10px 30px rgba(212,86,127,0.3);
    }
    
    button.primary:disabled::before{
      display:none;
    }
    
    button.ghost{
      background:transparent;
      border:2px solid var(--rose);
      color:var(--rose);
      padding:14px 28px;
      border-radius:50px;
      font-family:'Crimson Text',serif;
      font-size:1rem;
      cursor:pointer;
      transition:all 0.3s;
    }
    
    button.ghost:hover{
      background:var(--rose);
      color:#fff;
      transform:translateY(-2px);
    }
    
    .preview{
      margin-top:15px;
    }
    
    .file-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:12px;
    }
    
    .file-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 16px;
      border-radius:15px;
      background:linear-gradient(135deg, rgba(255,246,251,0.8) 0%, rgba(255,234,241,0.8) 100%);
      border:1px solid rgba(212,86,127,0.2);
      animation:fileItemAppear 0.4s ease;
    }
    
    @keyframes fileItemAppear {
      from {
        opacity:0;
        transform:translateX(-10px);
      }
      to {
        opacity:1;
        transform:translateX(0);
      }
    }
    
    .file-item strong{
      color:var(--deep-rose);
    }
    
    .small{
      font-size:0.9rem;
      color:#666;
    }
    
    .note{
      font-size:1rem;
      color:var(--rose);
      margin-top:20px;
      padding:15px;
      background:rgba(255,246,251,0.6);
      border-radius:12px;
      border-left:3px solid var(--rose);
      font-style:italic;
    }
    
    .note a{
      color:var(--deep-rose);
      font-weight:600;
      text-decoration:none;
      border-bottom:1px solid var(--deep-rose);
      transition:all 0.3s;
    }
    
    .note a:hover{
      color:var(--rose);
      border-bottom-color:var(--rose);
    }
    
    .link-container{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:15px;
      padding:12px;
      background:rgba(255,255,255,0.8);
      border-radius:12px;
      border:1px solid rgba(212,86,127,0.2);
    }
    
    .link-container a{
      flex:1;
      color:var(--deep-rose);
      font-weight:600;
      text-decoration:none;
      word-break:break-all;
    }
    
    .copy-btn{
      background:var(--rose);
      color:#fff;
      border:none;
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      font-family:'Crimson Text',serif;
      font-size:0.95rem;
      display:flex;
      align-items:center;
      gap:6px;
      transition:all 0.3s;
      white-space:nowrap;
      flex-shrink:0;
    }
    
    .copy-btn:hover{
      background:var(--deep-rose);
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(212,86,127,0.3);
    }
    
    .copy-btn.copied{
      background:#4caf50;
    }
    
    .copy-icon{
      font-size:1.1rem;
    }
    
    .decorative-heart{
      position:absolute;
      font-size:60px;
      opacity:0.05;
      pointer-events:none;
      animation:float 6s infinite ease-in-out;
    }
    
    @keyframes float {
      0%, 100% { transform:translateY(0) rotate(0deg); }
      50% { transform:translateY(-20px) rotate(5deg); }
    }
    
    .decorative-heart.top{
      top:50px;
      right:50px;
      animation-delay:0s;
    }
    
    .decorative-heart.bottom{
      bottom:50px;
      left:50px;
      animation-delay:3s;
    }
    
    @media(max-width:768px){
      body{ padding:20px; }
      .sheet{ padding:30px 25px; }
      h1{ font-size:2.2rem; }
      .intro{ font-size:1rem; }
      .actions{ flex-direction:column; }
      button.primary, button.ghost{ width:100%; }
      .decorative-heart{ display:none; }
    }
  </style>
</head>
<body>
  <!-- Floating hearts background -->
  <div class="hearts-bg" id="heartsBg"></div>
  
  <!-- Decorative elements -->
  <div class="decorative-heart top">üíï</div>
  <div class="decorative-heart bottom">‚ù§Ô∏è</div>
  
  <div class="sheet">
    <h1>Create Your Valentine</h1>
    <p class="intro">Craft a heartfelt digital experience to share with someone special</p>

    <label>From (your name)
      <input id="sender" type="text" placeholder="Your name (e.g., Alex)">
    </label>

    <label>To (their name)
      <input id="receiver" type="text" placeholder="Their name (e.g., Sam)">
    </label>

    <label>Your message
      <textarea id="message" placeholder="Write something from your heart..."></textarea>
      <span class="hint">Optional - A personal note that will appear in the experience</span>
    </label>

    <label>Theme / Mascot
      <select id="theme">
        <option value="rabbit">üê∞ Rabbit (soft & sweet)</option>
        <option value="hamster">üêπ Hamster (playful & cute)</option>
        <option value="classic">üíñ Classic (romantic hearts)</option>
      </select>
    </label>

    <label>Add photos or images
      <input id="files" type="file" multiple accept="image/*,application/pdf,text/*">
      <span class="hint">Choose memories you want to share together</span>
    </label>

    <label>Background music (optional)
      <input id="audioFile" type="file" accept="audio/*">
      <span class="hint">Add a special song to set the mood</span>
    </label>

    <div class="preview" id="filePreview">
      <p class="small" style="color:#999;">No files selected yet</p>
    </div>

    <div class="terms-section" style="margin-top:25px;">
      <label style="display:flex;align-items:start;gap:12px;cursor:pointer;margin-top:0;">
        <input type="checkbox" id="termsCheckbox" style="margin-top:4px;width:auto;cursor:pointer;">
        <span style="font-size:0.95rem;color:#666;line-height:1.6;font-weight:400;font-family:'Crimson Text',serif;">
          By continuing, you agree that uploaded media is used only to generate this experience. Files may be removed periodically for privacy and storage management. Please save or screen record your memory if you wish to keep it permanently.
        </span>
      </label>
    </div>

    <div class="actions">
      <button class="primary" id="createBtn" disabled>‚ú® Create & Publish ‚ú®</button>
      <button class="ghost" id="clearBtn" type="button">Clear All</button>
    </div>

    <div id="result" class="note" style="display:none;"></div>
    
    <div class="hint" style="text-align:center;margin-top:20px;">
  <div style="margin-bottom:8px;">üí° Tip:</div>
  <ul style="text-align:left;display:inline-block;margin:0;padding-left:20px;list-style-type:disc;">
    <li>Use MP3 format for audio.</li>
    <li>Your creation will be hosted and shared via a unique link.</li>
    <li>For faster loading and smoother experience, please upload compressed images and small audio files.</li>
  </ul>
</div>
  </div>

  <script>
    // Create floating hearts
    function createFloatingHearts() {
      const container = document.getElementById('heartsBg');
      const hearts = ['‚ô•', '‚ù§', 'üíï', 'üíó', 'üíñ'];
      for(let i = 0; i < 12; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart-float';
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
        heart.style.left = Math.random() * 100 + '%';
        heart.style.animationDelay = Math.random() * 15 + 's';
        heart.style.fontSize = (15 + Math.random() * 20) + 'px';
        container.appendChild(heart);
      }
    }
    createFloatingHearts();

    // Hardcoded service URL (replace if yours differs)
    const serverUrl = "https://uploader-server-h3iz.onrender.com";

    const filesInput = document.getElementById('files');
    const audioInput = document.getElementById('audioFile');
    const filePreview = document.getElementById('filePreview');
    const createBtn = document.getElementById('createBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultDiv = document.getElementById('result');
    const termsCheckbox = document.getElementById('termsCheckbox');

    let selectedFiles = [];
    let selectedAudio = null;

    // Handle terms checkbox
    termsCheckbox.addEventListener('change', () => {
      createBtn.disabled = !termsCheckbox.checked;
    });

    filesInput.addEventListener('change', () => {
      selectedFiles = Array.from(filesInput.files || []);
      renderFileList();
    });

    audioInput.addEventListener('change', () => {
      selectedAudio = audioInput.files && audioInput.files[0] ? audioInput.files[0] : null;
      renderFileList();
    });

    clearBtn.addEventListener('click', () => {
      document.getElementById('sender').value = '';
      document.getElementById('receiver').value = '';
      document.getElementById('message').value = '';
      document.getElementById('theme').value = 'rabbit';
      filesInput.value = '';
      audioInput.value = '';
      selectedFiles = [];
      selectedAudio = null;
      termsCheckbox.checked = false;
      createBtn.disabled = true;
      renderFileList();
      resultDiv.style.display = 'none';
      resultDiv.textContent = '';
    });

    function renderFileList(){
      if (!selectedFiles.length && !selectedAudio){
        filePreview.innerHTML = '<p class="small" style="color:#999;">No files selected yet</p>';
        return;
      }
      const container = document.createElement('div');
      container.className = 'file-list';
      selectedFiles.forEach(f => {
        const it = document.createElement('div');
        it.className = 'file-item';
        it.innerHTML = `<div><strong>${escapeHtml(f.name)}</strong><div class="small">${(f.size/1024).toFixed(1)} KB</div></div>
                        <div class="small">üì∑ Image</div>`;
        container.appendChild(it);
      });
      if (selectedAudio){
        const it = document.createElement('div');
        it.className = 'file-item';
        it.innerHTML = `<div><strong>${escapeHtml(selectedAudio.name)}</strong><div class="small">${(selectedAudio.size/1024).toFixed(1)} KB</div></div>
                        <div class="small">üéµ Background music</div>`;
        container.appendChild(it);
      }
      filePreview.innerHTML = '';
      filePreview.appendChild(container);
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    createBtn.addEventListener('click', async () => {
      const sender = document.getElementById('sender').value.trim();
      const receiver = document.getElementById('receiver').value.trim();
      const message = document.getElementById('message').value.trim();
      const theme = document.getElementById('theme').value;

      if (!sender) return alert('Please enter your name (sender).');
      if (!receiver) return alert('Please enter the receiver name.');

      if (!selectedFiles.length && !selectedAudio){
        if (!confirm('No files or audio selected. Continue anyway?')) return;
      }

      const fd = new FormData();
      // append images/files
      for (const f of selectedFiles) fd.append('files', f, f.name);
      // append audio file if present (always treated as background)
      if (selectedAudio){
        fd.append('files', selectedAudio, selectedAudio.name);
        // always mark audio as background when present
        fd.append('bg', selectedAudio.name);
      }

      // metadata fields
      fd.append('sender', sender);
      fd.append('receiver', receiver);
      if (message) fd.append('message', message);
      if (theme) fd.append('theme', theme);

      createBtn.disabled = true;
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '‚ú® Creating your Valentine experience... This may take up to 30 seconds. Please wait ‚ù§Ô∏è';

      try {
        const resp = await fetch(serverUrl.replace(/\/$/, '') + '/upload', { method: 'POST', body: fd });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || JSON.stringify(data));
        
        resultDiv.innerHTML = `
          <strong>üéâ Your Valentine is ready!</strong><br><br>
          <div style="margin-bottom:10px;">Share this link with your special someone:</div>
          <div class="link-container">
            <a href="${data.pagesURL}" target="_blank" id="generatedLink">${data.pagesURL}</a>
            <button class="copy-btn" id="copyBtn">
              <span class="copy-icon">üìã</span>
              <span id="copyText">Copy</span>
            </button>
          </div>
        `;
        
        // Add copy functionality
        const copyBtn = document.getElementById('copyBtn');
        const copyText = document.getElementById('copyText');
        const generatedLink = document.getElementById('generatedLink');
        
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(data.pagesURL);
            copyBtn.classList.add('copied');
            copyText.textContent = '‚úì Copied!';
            setTimeout(() => {
              copyBtn.classList.remove('copied');
              copyText.textContent = 'Copy';
            }, 2000);
          } catch (err) {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = data.pagesURL;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand('copy');
              copyBtn.classList.add('copied');
              copyText.textContent = '‚úì Copied!';
              setTimeout(() => {
                copyBtn.classList.remove('copied');
                copyText.textContent = 'Copy';
              }, 2000);
            } catch (e) {
              alert('Copy failed. Please manually select and copy the link.');
            }
            document.body.removeChild(textArea);
          }
        });
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = '‚ùå Upload failed: ' + (err.message || err);
      } finally {
        createBtn.disabled = false;
      }
    });

    // init
    renderFileList();
  </script>
</body>
</html>
